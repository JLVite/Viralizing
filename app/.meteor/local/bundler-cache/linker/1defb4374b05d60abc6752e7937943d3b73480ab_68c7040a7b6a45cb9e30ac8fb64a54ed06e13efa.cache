[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar Herald = Package['kestanous:herald'].Herald;\nvar _ = Package.underscore._;\n\n(function(){\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                          //\n// packages/kestanous_herald-web-notifications/packages/kestanous_herald-web-notifications. //\n//                                                                                          //\n//////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                            //\n(function () {\n\n////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                    //\n// packages/kestanous:herald-web-notifications/lib/web-notifications.js               //\n//                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////\n                                                                                      //\nvar runner = {                                                                        // 1\n  name: 'webNotification',                                                            // 2\n  where: ['client']                                                                   // 3\n};                                                                                    // 4\n                                                                                      // 5\nrunner.run = function (notification, user) {                                          // 6\n  //respect the user and w3c                                                          // 7\n  if (!Notification.permission) return;                                               // 8\n  if (Notification.permission == 'denied') return;                                    // 9\n                                                                                      // 10\n  //TODO: Check if user is idle!                                                      // 11\n                                                                                      // 12\n  var title = '';                                                                     // 13\n  if (_.isFunction(this.title)) {                                                     // 14\n    title = this.title.call(notification, user);                                      // 15\n  } else {                                                                            // 16\n    title = this.title;                                                               // 17\n  }                                                                                   // 18\n                                                                                      // 19\n  var options = {};                                                                   // 20\n                                                                                      // 21\n  //tag is an id for finding and reduce same notification spam, so _id is appropriate // 22\n  options.tag = notification._id;                                                     // 23\n                                                                                      // 24\n  if (_.isFunction(this.body))                                                        // 25\n    options.body = this.body.call(notification, user);                                // 26\n  else                                                                                // 27\n    options.body = this.body;                                                         // 28\n                                                                                      // 29\n  //optionals                                                                         // 30\n  if (this.dir) {                                                                     // 31\n    if (_.isString(this.dir))                                                         // 32\n      options.dir = this.dir;                                                         // 33\n    else                                                                              // 34\n      options.dir = this.dir.call(notification, user);                                // 35\n  }                                                                                   // 36\n                                                                                      // 37\n  if (this.lang) {                                                                    // 38\n    if (_.isString(this.lang))                                                        // 39\n      options.lang = this.lang;                                                       // 40\n    else                                                                              // 41\n      options.lang = this.lang.call(notification, user);                              // 42\n  }                                                                                   // 43\n                                                                                      // 44\n  if (this.icon) {                                                                    // 45\n    if (_.isString(this.icon))                                                        // 46\n      options.icon = this.icon;                                                       // 47\n    else                                                                              // 48\n      options.icon = this.icon.call(notification, user);                              // 49\n  }                                                                                   // 50\n                                                                                      // 51\n  var windowNotification = new Notification(title, options);                          // 52\n                                                                                      // 53\n  // onclick focus the window                                                         // 54\n  if (_.isFunction(this.onclick)) {                                                   // 55\n    windowNotification.onclick = this.onclick;                                        // 56\n  } else {                                                                            // 57\n    windowNotification.onclick = function (e) {                                       // 58\n      window.focus();                                                                 // 59\n      if (notification.url) {                                                         // 60\n        // check if iron:router is set                                                // 61\n        if (Package['iron:router']) {                                                 // 62\n          Router.go(notification.url);                                                // 63\n        } else {                                                                      // 64\n          window.location.href = notification.url;                                    // 65\n        }                                                                             // 66\n      }                                                                               // 67\n    }                                                                                 // 68\n  }                                                                                   // 69\n};                                                                                    // 70\n                                                                                      // 71\nrunner.check = function (notification, user) {                                        // 72\n  if (!(_.isString(this.title) || _.isFunction(this.title)))                          // 73\n    throw new Error('Herald-Web-Notifications: title must be string or function')     // 74\n                                                                                      // 75\n  if (!(_.isString(this.body) || _.isFunction(this.body)))                            // 76\n    throw new Error('Herald-Web-Notifications: body must be string or function')      // 77\n};                                                                                    // 78\n                                                                                      // 79\nHerald.addRunner(runner);                                                             // 80\n////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n//////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nPackage._define(\"kestanous:herald-web-notifications\");\n\n})();\n","servePath":"/packages/kestanous_herald-web-notifications.js"}]