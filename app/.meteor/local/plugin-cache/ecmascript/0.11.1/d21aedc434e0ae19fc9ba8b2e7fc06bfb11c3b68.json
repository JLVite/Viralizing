{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$4","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$5","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$6","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$7","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$9","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/modules/core/ui/layouts/app.jsx","filename":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","passPerPreset":false,"envName":"development","cwd":"/home/blackstoneteam/repos/viralizing-web/app","root":"/home/blackstoneteam/repos/viralizing-web/app","generatorOpts":{"filename":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/modules/core/ui/layouts/app.jsx"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/builtin/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/builtin/objectSpread\"));\n\nlet React;\nmodule.watch(require(\"react\"), {\n  default(v) {\n    React = v;\n  }\n\n}, 0);\nlet LocalStorage;\nmodule.watch(require(\"../../client/LocalStorage\"), {\n  default(v) {\n    LocalStorage = v;\n  }\n\n}, 1);\nlet Modal;\nmodule.watch(require(\"react-modal\"), {\n  default(v) {\n    Modal = v;\n  }\n\n}, 2);\nlet CookieName;\nmodule.watch(require(\"../../settings\"), {\n  CookieName(v) {\n    CookieName = v;\n  }\n\n}, 3);\nlet withRouter;\nmodule.watch(require(\"react-router\"), {\n  withRouter(v) {\n    withRouter = v;\n  }\n\n}, 4);\nlet NavBar;\nmodule.watch(require(\"../components/nav-bar/nav-bar\"), {\n  default(v) {\n    NavBar = v;\n  }\n\n}, 5);\nlet MenuBar;\nmodule.watch(require(\"../components/menu-bar\"), {\n  default(v) {\n    MenuBar = v;\n  }\n\n}, 6);\nlet ProfileData;\nmodule.watch(require(\"../components/profile-information/layout\"), {\n  default(v) {\n    ProfileData = v;\n  }\n\n}, 7);\nlet browserHistory;\nmodule.watch(require(\"react-router\"), {\n  browserHistory(v) {\n    browserHistory = v;\n  }\n\n}, 8);\nlet PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  default(v) {\n    PropTypes = v;\n  }\n\n}, 9);\nbrowserHistory.listen(location => {\n  const path = location.pathname;\n\n  if (path !== \"/auth/login\" && path !== \"/auth/restore\" && path !== \"/auth/register\" && path !== \"/auth/recover\") {\n    localStorage.setItem(\"redirect-to\", window.location.pathname + window.location.search);\n  }\n});\nconst COOKIE_NAME = CookieName + \"_USER_DATA\";\n\nclass App extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      modals: {\n        profileData: false\n      },\n      initialized: false\n    };\n    this.openModal = this.openModal.bind(this);\n    this.closeModal = this.closeModal.bind(this);\n    this.checkFlags = this.checkFlags.bind(this);\n  }\n\n  openModal(modal) {\n    let component = this;\n    return function () {\n      let newState = (0, _objectSpread2.default)({}, component.state);\n      newState.modals[modal] = true;\n      component.setState(newState);\n    };\n  }\n\n  closeModal(modal) {\n    let component = this;\n    return function () {\n      let newState = (0, _objectSpread2.default)({}, component.state);\n      newState.modals[modal] = false;\n      component.setState(newState);\n    };\n  }\n\n  isLoggedIn() {\n    return Meteor.user() || false;\n  }\n\n  isSanctioned() {\n    const history = this.props.router;\n    let isSanctioned = false;\n\n    if (!isSanctioned) {\n      isSanctioned = history.isActive(\"/auth/login\") || history.isActive(\"/auth/recover\") || history.isActive(\"/auth/register\") || history.isActive(\"/auth/restore\");\n    }\n\n    return isSanctioned;\n  }\n\n  redirectToAuth() {\n    let redirect = \"/auth/login\";\n\n    if (this.isSanctioned()) {\n      return;\n    }\n\n    if (LocalStorage.getItem(COOKIE_NAME)) {\n      redirect = \"/auth/restore\";\n    }\n\n    this.props.router.push(redirect);\n  }\n\n  componentWillMount() {\n    let component = this;\n\n    let checkAuth = function () {\n      if (!Meteor.user()) {\n        component.redirectToAuth();\n      } else {\n        if (window.localStorage.getItem(CookieName + \"_USER_DATA\")) {\n          let user = Meteor.user();\n\n          if (user.emails && user.emails[0]) {\n            let userData = {\n              _id: user._id,\n              email: user.emails[0].address,\n              name: user.profile.name,\n              avatar: user.profile.avatar\n            };\n            window.localStorage.setItem(CookieName + \"_USER_DATA\", JSON.stringify(userData));\n          }\n        }\n\n        if (!component.state.initialized) {\n          component.checkFlags();\n          component.setState({\n            initialized: true\n          });\n        }\n      }\n    };\n\n    checkAuth();\n    this.userCheck = setInterval(checkAuth, 5000);\n  }\n\n  checkFlags() {\n    let component = this;\n    Meteor.call(\"users-get-flags\", function (err, res) {\n      if (res) {\n        if (!res.askedProfileData) {\n          component.openModal(\"profileData\")();\n        }\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    if (this.userCheck) {\n      clearInterval(this.userCheck);\n    }\n  }\n\n  render() {\n    let filter = obj => {\n      let newProps = {};\n      let key;\n\n      for (key in obj) {\n        if (key !== \"children\") {\n          newProps[key] = obj[key];\n        }\n      }\n\n      return newProps;\n    };\n\n    return React.createElement(\"div\", null, this.isLoggedIn() ? React.createElement(NavBar, null) : React.createElement(\"div\", null), this.isLoggedIn() ? React.createElement(MenuBar, {\n      path: this.props.location.query.path\n    }) : React.createElement(\"div\", null), React.createElement(\"div\", {\n      id: \"container\",\n      className: this.isLoggedIn() ? \"page\" : \"auth\"\n    }, React.cloneElement(this.props.children, filter(this.props))), React.createElement(Modal, {\n      isOpen: this.state.modals.profileData,\n      onRequestClose: this.closeModal(\"profileData\"),\n      className: \"full-app-modal\",\n      shouldCloseOnEsc: false,\n      contentLabel: \"User Profile\"\n    }, React.createElement(ProfileData, {\n      close: this.closeModal(\"profileData\")\n    })));\n  }\n\n}\n\nApp.propTypes = {\n  router: PropTypes.shape({\n    push: PropTypes.func.isRequired\n  }).isRequired\n};\nmodule.exportDefault(withRouter(App));","map":{"version":3,"sources":["imports/modules/core/ui/layouts/app.jsx"],"names":["React","module","watch","require","default","v","LocalStorage","Modal","CookieName","withRouter","NavBar","MenuBar","ProfileData","browserHistory","PropTypes","listen","location","path","pathname","localStorage","setItem","window","search","COOKIE_NAME","App","Component","constructor","state","modals","profileData","initialized","openModal","bind","closeModal","checkFlags","modal","component","newState","setState","isLoggedIn","Meteor","user","isSanctioned","history","props","router","isActive","redirectToAuth","redirect","getItem","push","componentWillMount","checkAuth","emails","userData","_id","email","address","name","profile","avatar","JSON","stringify","userCheck","setInterval","call","err","res","askedProfileData","componentWillUnmount","clearInterval","render","filter","obj","newProps","key","query","cloneElement","children","propTypes","shape","func","isRequired","exportDefault"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport LocalStorage from \"../../client/LocalStorage\";\nimport Modal from \"react-modal\";\nimport {CookieName} from \"../../settings\";\nimport {withRouter} from \"react-router\";\nimport NavBar from \"../components/nav-bar/nav-bar\";\nimport MenuBar from \"../components/menu-bar\";\nimport ProfileData from \"../components/profile-information/layout\";\nimport {browserHistory} from \"react-router\";\nimport PropTypes from 'prop-types';\n\nbrowserHistory.listen(location => {\n    const path = location.pathname;\n    if (path !== \"/auth/login\" && path !== \"/auth/restore\" && path !== \"/auth/register\" && path !== \"/auth/recover\") {\n        localStorage.setItem(\"redirect-to\", window.location.pathname+window.location.search);\n    }\n});\n\nconst COOKIE_NAME = CookieName + \"_USER_DATA\";\n\nclass App extends React.Component {\n    constructor() {\n        super();\n\n        this.state = {\n            modals: {\n                profileData: false\n            },\n            initialized: false\n        };\n\n        this.openModal = this.openModal.bind(this);\n        this.closeModal = this.closeModal.bind(this);\n        this.checkFlags = this.checkFlags.bind(this);\n    }\n\n    openModal(modal) {\n        let component = this;\n        return function () {\n            let newState = {...component.state};\n            newState.modals[modal] = true;\n            component.setState(newState);\n        }\n    }\n\n    closeModal(modal) {\n        let component = this;\n        return function () {\n            let newState = {...component.state};\n            newState.modals[modal] = false;\n            component.setState(newState);\n        }\n    }\n\n    isLoggedIn() {\n        return Meteor.user() || false\n    }\n\n    isSanctioned() {\n        const history = this.props.router;\n\n        let isSanctioned = false;\n        if (!isSanctioned) {\n            isSanctioned = history.isActive(\"/auth/login\") || history.isActive(\"/auth/recover\") || history.isActive(\"/auth/register\") || history.isActive(\"/auth/restore\");\n        }\n\n        return isSanctioned\n    }\n\n    redirectToAuth() {\n        let redirect = \"/auth/login\";\n        if (this.isSanctioned()) {\n            return\n        }\n        if (LocalStorage.getItem(COOKIE_NAME)) {\n            redirect = \"/auth/restore\";\n        }\n        this.props.router.push(redirect);\n    }\n\n    componentWillMount() {\n        let component = this;\n        let checkAuth = function () {\n            if (!Meteor.user()) {\n                component.redirectToAuth()\n            } else {\n                if (window.localStorage.getItem(CookieName + \"_USER_DATA\")) {\n                    let user = Meteor.user();\n                    if(user.emails && user.emails[0]){\n                        let userData = {\n                            _id: user._id,\n                            email: user.emails[0].address,\n                            name: user.profile.name,\n                            avatar: user.profile.avatar\n                        };\n                        window.localStorage.setItem(CookieName + \"_USER_DATA\", JSON.stringify(userData));\n                    }\n                }\n                if (!component.state.initialized) {\n                    component.checkFlags();\n                    component.setState({initialized: true});\n                }\n            }\n        };\n        checkAuth();\n        this.userCheck = setInterval(checkAuth, 5000)\n    }\n\n    checkFlags() {\n        let component = this;\n        Meteor.call(\"users-get-flags\", function (err, res) {\n            if (res) {\n                if (!res.askedProfileData) {\n                    component.openModal(\"profileData\")();\n                }\n            }\n        })\n    }\n\n    componentWillUnmount() {\n        if (this.userCheck) {\n            clearInterval(this.userCheck);\n        }\n    }\n\n    render() {\n        let filter = (obj) => {\n            let newProps = {};\n            let key;\n            for (key in obj) {\n                if (key !== \"children\") {\n                    newProps[key] = obj[key];\n                }\n            }\n            return newProps;\n        };\n\n        return (\n            <div>\n                {this.isLoggedIn() ? <NavBar/> : <div/>}\n                {this.isLoggedIn() ? <MenuBar path={this.props.location.query.path}/> : <div/>}\n\n                <div id=\"container\" className={this.isLoggedIn() ? \"page\" : \"auth\"}>\n                    {React.cloneElement(this.props.children, filter(this.props))}\n                </div>\n\n                <Modal\n                    isOpen={this.state.modals.profileData}\n                    onRequestClose={this.closeModal(\"profileData\")}\n                    className=\"full-app-modal\"\n                    shouldCloseOnEsc={false}\n                    contentLabel=\"User Profile\"\n                >\n                    <ProfileData close={this.closeModal(\"profileData\")}/>\n                </Modal>\n            </div>\n        )\n    }\n}\n\nApp.propTypes = {\n    router: PropTypes.shape({\n        push: PropTypes.func.isRequired\n    }).isRequired\n};\n\nexport default withRouter(App);\n"]},"sourceType":"script","hash":"d21aedc434e0ae19fc9ba8b2e7fc06bfb11c3b68"}
