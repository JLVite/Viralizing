{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/modules/core/ui/layouts/app.jsx","filename":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","passPerPreset":false,"envName":"development","cwd":"/home/blackstoneteam/repos/viralizing-web/app","root":"/home/blackstoneteam/repos/viralizing-web/app","generatorOpts":{"filename":"/home/blackstoneteam/repos/viralizing-web/app/imports/modules/core/ui/layouts/app.jsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/modules/core/ui/layouts/app.jsx"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar React;\nmodule.watch(require(\"react\"), {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 0);\nvar LocalStorage;\nmodule.watch(require(\"../../client/LocalStorage\"), {\n  \"default\": function (v) {\n    LocalStorage = v;\n  }\n}, 1);\nvar Modal;\nmodule.watch(require(\"react-modal\"), {\n  \"default\": function (v) {\n    Modal = v;\n  }\n}, 2);\nvar CookieName;\nmodule.watch(require(\"../../settings\"), {\n  CookieName: function (v) {\n    CookieName = v;\n  }\n}, 3);\nvar withRouter;\nmodule.watch(require(\"react-router\"), {\n  withRouter: function (v) {\n    withRouter = v;\n  }\n}, 4);\nvar NavBar;\nmodule.watch(require(\"../components/nav-bar/nav-bar\"), {\n  \"default\": function (v) {\n    NavBar = v;\n  }\n}, 5);\nvar MenuBar;\nmodule.watch(require(\"../components/menu-bar\"), {\n  \"default\": function (v) {\n    MenuBar = v;\n  }\n}, 6);\nvar ProfileData;\nmodule.watch(require(\"../components/profile-information/layout\"), {\n  \"default\": function (v) {\n    ProfileData = v;\n  }\n}, 7);\nvar browserHistory;\nmodule.watch(require(\"react-router\"), {\n  browserHistory: function (v) {\n    browserHistory = v;\n  }\n}, 8);\nvar PropTypes;\nmodule.watch(require(\"prop-types\"), {\n  \"default\": function (v) {\n    PropTypes = v;\n  }\n}, 9);\nbrowserHistory.listen(function (location) {\n  var path = location.pathname;\n\n  if (path !== \"/auth/login\" && path !== \"/auth/restore\" && path !== \"/auth/register\" && path !== \"/auth/recover\") {\n    localStorage.setItem(\"redirect-to\", window.location.pathname + window.location.search);\n  }\n});\nvar COOKIE_NAME = CookieName + \"_USER_DATA\";\n\nvar App =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inheritsLoose2.default)(App, _React$Component);\n\n  function App() {\n    var _this;\n\n    _this = _React$Component.call(this) || this;\n    _this.state = {\n      modals: {\n        profileData: false\n      },\n      initialized: false\n    };\n    _this.openModal = _this.openModal.bind((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)));\n    _this.closeModal = _this.closeModal.bind((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)));\n    _this.checkFlags = _this.checkFlags.bind((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)));\n    return _this;\n  }\n\n  var _proto = App.prototype;\n\n  _proto.openModal = function () {\n    function openModal(modal) {\n      var component = this;\n      return function () {\n        var newState = (0, _objectSpread2.default)({}, component.state);\n        newState.modals[modal] = true;\n        component.setState(newState);\n      };\n    }\n\n    return openModal;\n  }();\n\n  _proto.closeModal = function () {\n    function closeModal(modal) {\n      var component = this;\n      return function () {\n        var newState = (0, _objectSpread2.default)({}, component.state);\n        newState.modals[modal] = false;\n        component.setState(newState);\n      };\n    }\n\n    return closeModal;\n  }();\n\n  _proto.isLoggedIn = function () {\n    function isLoggedIn() {\n      return Meteor.user() || false;\n    }\n\n    return isLoggedIn;\n  }();\n\n  _proto.isSanctioned = function () {\n    function isSanctioned() {\n      var history = this.props.router;\n      var isSanctioned = false;\n\n      if (!isSanctioned) {\n        isSanctioned = history.isActive(\"/auth/login\") || history.isActive(\"/auth/recover\") || history.isActive(\"/auth/register\") || history.isActive(\"/auth/restore\");\n      }\n\n      return isSanctioned;\n    }\n\n    return isSanctioned;\n  }();\n\n  _proto.redirectToAuth = function () {\n    function redirectToAuth() {\n      var redirect = \"/auth/login\";\n\n      if (this.isSanctioned()) {\n        return;\n      }\n\n      if (LocalStorage.getItem(COOKIE_NAME)) {\n        redirect = \"/auth/restore\";\n      }\n\n      this.props.router.push(redirect);\n    }\n\n    return redirectToAuth;\n  }();\n\n  _proto.componentWillMount = function () {\n    function componentWillMount() {\n      var component = this;\n\n      var checkAuth = function () {\n        if (!Meteor.user()) {\n          component.redirectToAuth();\n        } else {\n          if (window.localStorage.getItem(CookieName + \"_USER_DATA\")) {\n            var user = Meteor.user();\n\n            if (user.emails && user.emails[0]) {\n              var userData = {\n                _id: user._id,\n                email: user.emails[0].address,\n                name: user.profile.name,\n                avatar: user.profile.avatar\n              };\n              window.localStorage.setItem(CookieName + \"_USER_DATA\", JSON.stringify(userData));\n            }\n          }\n\n          if (!component.state.initialized) {\n            component.checkFlags();\n            component.setState({\n              initialized: true\n            });\n          }\n        }\n      };\n\n      checkAuth();\n      this.userCheck = setInterval(checkAuth, 5000);\n    }\n\n    return componentWillMount;\n  }();\n\n  _proto.checkFlags = function () {\n    function checkFlags() {\n      var component = this;\n      Meteor.call(\"users-get-flags\", function (err, res) {\n        if (res) {\n          if (!res.askedProfileData) {\n            component.openModal(\"profileData\")();\n          }\n        }\n      });\n    }\n\n    return checkFlags;\n  }();\n\n  _proto.componentWillUnmount = function () {\n    function componentWillUnmount() {\n      if (this.userCheck) {\n        clearInterval(this.userCheck);\n      }\n    }\n\n    return componentWillUnmount;\n  }();\n\n  _proto.render = function () {\n    function render() {\n      var filter = function (obj) {\n        var newProps = {};\n        var key;\n\n        for (key in meteorBabelHelpers.sanitizeForInObject(obj)) {\n          if (key !== \"children\") {\n            newProps[key] = obj[key];\n          }\n        }\n\n        return newProps;\n      };\n\n      return React.createElement(\"div\", null, this.isLoggedIn() ? React.createElement(NavBar, null) : React.createElement(\"div\", null), this.isLoggedIn() ? React.createElement(MenuBar, {\n        path: this.props.location.query.path\n      }) : React.createElement(\"div\", null), React.createElement(\"div\", {\n        id: \"container\",\n        className: this.isLoggedIn() ? \"page\" : \"auth\"\n      }, React.cloneElement(this.props.children, filter(this.props))), React.createElement(Modal, {\n        isOpen: this.state.modals.profileData,\n        onRequestClose: this.closeModal(\"profileData\"),\n        className: \"full-app-modal\",\n        shouldCloseOnEsc: false,\n        contentLabel: \"User Profile\"\n      }, React.createElement(ProfileData, {\n        close: this.closeModal(\"profileData\")\n      })));\n    }\n\n    return render;\n  }();\n\n  return App;\n}(React.Component);\n\nApp.propTypes = {\n  router: PropTypes.shape({\n    push: PropTypes.func.isRequired\n  }).isRequired\n};\nmodule.exportDefault(withRouter(App));","map":{"version":3,"sources":["imports/modules/core/ui/layouts/app.jsx"],"names":["React","module","watch","require","v","LocalStorage","Modal","CookieName","withRouter","NavBar","MenuBar","ProfileData","browserHistory","PropTypes","listen","path","location","pathname","localStorage","setItem","window","search","COOKIE_NAME","App","state","modals","profileData","initialized","openModal","bind","closeModal","checkFlags","modal","component","newState","setState","isLoggedIn","Meteor","user","isSanctioned","history","props","router","isActive","redirectToAuth","redirect","getItem","push","componentWillMount","checkAuth","emails","userData","_id","email","address","name","profile","avatar","JSON","stringify","userCheck","setInterval","call","err","res","askedProfileData","componentWillUnmount","clearInterval","render","filter","obj","newProps","key","query","cloneElement","children","Component","propTypes","shape","func","isRequired","exportDefault"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport LocalStorage from \"../../client/LocalStorage\";\nimport Modal from \"react-modal\";\nimport {CookieName} from \"../../settings\";\nimport {withRouter} from \"react-router\";\nimport NavBar from \"../components/nav-bar/nav-bar\";\nimport MenuBar from \"../components/menu-bar\";\nimport ProfileData from \"../components/profile-information/layout\";\nimport {browserHistory} from \"react-router\";\nimport PropTypes from 'prop-types';\n\nbrowserHistory.listen(location => {\n    const path = location.pathname;\n    if (path !== \"/auth/login\" && path !== \"/auth/restore\" && path !== \"/auth/register\" && path !== \"/auth/recover\") {\n        localStorage.setItem(\"redirect-to\", window.location.pathname+window.location.search);\n    }\n});\n\nconst COOKIE_NAME = CookieName + \"_USER_DATA\";\n\nclass App extends React.Component {\n    constructor() {\n        super();\n\n        this.state = {\n            modals: {\n                profileData: false\n            },\n            initialized: false\n        };\n\n        this.openModal = this.openModal.bind(this);\n        this.closeModal = this.closeModal.bind(this);\n        this.checkFlags = this.checkFlags.bind(this);\n    }\n\n    openModal(modal) {\n        let component = this;\n        return function () {\n            let newState = {...component.state};\n            newState.modals[modal] = true;\n            component.setState(newState);\n        }\n    }\n\n    closeModal(modal) {\n        let component = this;\n        return function () {\n            let newState = {...component.state};\n            newState.modals[modal] = false;\n            component.setState(newState);\n        }\n    }\n\n    isLoggedIn() {\n        return Meteor.user() || false\n    }\n\n    isSanctioned() {\n        const history = this.props.router;\n\n        let isSanctioned = false;\n        if (!isSanctioned) {\n            isSanctioned = history.isActive(\"/auth/login\") || history.isActive(\"/auth/recover\") || history.isActive(\"/auth/register\") || history.isActive(\"/auth/restore\");\n        }\n\n        return isSanctioned\n    }\n\n    redirectToAuth() {\n        let redirect = \"/auth/login\";\n        if (this.isSanctioned()) {\n            return\n        }\n        if (LocalStorage.getItem(COOKIE_NAME)) {\n            redirect = \"/auth/restore\";\n        }\n        this.props.router.push(redirect);\n    }\n\n    componentWillMount() {\n        let component = this;\n        let checkAuth = function () {\n            if (!Meteor.user()) {\n                component.redirectToAuth()\n            } else {\n                if (window.localStorage.getItem(CookieName + \"_USER_DATA\")) {\n                    let user = Meteor.user();\n                    if(user.emails && user.emails[0]){\n                        let userData = {\n                            _id: user._id,\n                            email: user.emails[0].address,\n                            name: user.profile.name,\n                            avatar: user.profile.avatar\n                        };\n                        window.localStorage.setItem(CookieName + \"_USER_DATA\", JSON.stringify(userData));\n                    }\n                }\n                if (!component.state.initialized) {\n                    component.checkFlags();\n                    component.setState({initialized: true});\n                }\n            }\n        };\n        checkAuth();\n        this.userCheck = setInterval(checkAuth, 5000)\n    }\n\n    checkFlags() {\n        let component = this;\n        Meteor.call(\"users-get-flags\", function (err, res) {\n            if (res) {\n                if (!res.askedProfileData) {\n                    component.openModal(\"profileData\")();\n                }\n            }\n        })\n    }\n\n    componentWillUnmount() {\n        if (this.userCheck) {\n            clearInterval(this.userCheck);\n        }\n    }\n\n    render() {\n        let filter = (obj) => {\n            let newProps = {};\n            let key;\n            for (key in obj) {\n                if (key !== \"children\") {\n                    newProps[key] = obj[key];\n                }\n            }\n            return newProps;\n        };\n\n        return (\n            <div>\n                {this.isLoggedIn() ? <NavBar/> : <div/>}\n                {this.isLoggedIn() ? <MenuBar path={this.props.location.query.path}/> : <div/>}\n\n                <div id=\"container\" className={this.isLoggedIn() ? \"page\" : \"auth\"}>\n                    {React.cloneElement(this.props.children, filter(this.props))}\n                </div>\n\n                <Modal\n                    isOpen={this.state.modals.profileData}\n                    onRequestClose={this.closeModal(\"profileData\")}\n                    className=\"full-app-modal\"\n                    shouldCloseOnEsc={false}\n                    contentLabel=\"User Profile\"\n                >\n                    <ProfileData close={this.closeModal(\"profileData\")}/>\n                </Modal>\n            </div>\n        )\n    }\n}\n\nApp.propTypes = {\n    router: PropTypes.shape({\n        push: PropTypes.func.isRequired\n    }).isRequired\n};\n\nexport default withRouter(App);\n"]},"sourceType":"script","hash":"28590de8c7f2558bdea784c072b2b0581db7129e"}
