{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/home/blackstoneteam/repos/viralizing-web/app/packages/apollo/src/main-client.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"packages/apollo/src/main-client.js","filename":"/home/blackstoneteam/repos/viralizing-web/app/packages/apollo/src/main-client.js","passPerPreset":false,"envName":"development","cwd":"/home/blackstoneteam/repos/viralizing-web/app","root":"/home/blackstoneteam/repos/viralizing-web/app","generatorOpts":{"filename":"/home/blackstoneteam/repos/viralizing-web/app/packages/apollo/src/main-client.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/apollo/src/main-client.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nmodule.export({\n  createMeteorNetworkInterface: function () {\n    return createMeteorNetworkInterface;\n  },\n  meteorClientConfig: function () {\n    return meteorClientConfig;\n  },\n  getMeteorLoginToken: function () {\n    return getMeteorLoginToken;\n  }\n});\nvar createNetworkInterface, createBatchingNetworkInterface;\nmodule.watch(require(\"apollo-client\"), {\n  createNetworkInterface: function (v) {\n    createNetworkInterface = v;\n  },\n  createBatchingNetworkInterface: function (v) {\n    createBatchingNetworkInterface = v;\n  }\n}, 0);\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Accounts;\nmodule.watch(require(\"meteor/accounts-base\"), {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 2);\n// default network interface configuration object\nvar defaultNetworkInterfaceConfig = {\n  // default graphql server endpoint: ROOT_URL/graphql\n  // ex: http://locahost:3000/graphql, or https://www.my-app.com/graphql\n  uri: Meteor.absoluteUrl('graphql'),\n  // additional fetch options like `credentials` or `headers`\n  opts: {},\n  // enable the Meteor User Accounts middleware to identify the user with\n  // every request thanks to their login token\n  useMeteorAccounts: true,\n  // use a BatchingNetworkInterface by default instead of a NetworkInterface\n  batchingInterface: true,\n  // default batch interval\n  batchInterval: 10\n}; // create a pre-configured network interface\n\nvar createMeteorNetworkInterface = function () {\n  var customNetworkInterfaceConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  // create a new config object based on the default network interface config\n  // defined above and the custom network interface config passed to this function\n  var config = (0, _objectSpread2.default)({}, defaultNetworkInterfaceConfig, customNetworkInterfaceConfig); // this will be true true if a BatchingNetworkInterface is meant to be used\n  // with a correct poll interval\n\n  var useBatchingInterface = config.batchingInterface && typeof config.batchInterval === 'number'; // allow the use of a batching network interface\n\n  var interfaceToUse = useBatchingInterface ? createBatchingNetworkInterface : createNetworkInterface; // http://dev.apollodata.com/core/apollo-client-api.html#NetworkInterfaceOptions\n\n  var interfaceArgument = {\n    uri: config.uri,\n    opts: config.opts\n  }; // http://dev.apollodata.com/core/network.html#BatchingExample\n\n  if (useBatchingInterface) {\n    interfaceArgument.batchInterval = config.batchInterval;\n  } // configure the (batching?) network interface with the config defined above\n\n\n  var networkInterface = interfaceToUse(interfaceArgument); // handle the creation of a Meteor User Accounts middleware\n\n  if (config.useMeteorAccounts) {\n    try {\n      var _ref;\n\n      // throw an error if someone tries to specify the login token\n      // manually from the client\n      if (Meteor.isClient && config.loginToken) {\n        throw Error('[Meteor Apollo Integration] The current user is not handled with your GraphQL operations: you are trying to pass a login token to an Apollo Client instance defined client-side. This is only allowed during server-side rendering, please check your implementation.');\n      } // dynamic middleware function name depending on the interface used\n\n\n      var applyMiddlewareFn = useBatchingInterface ? 'applyBatchMiddleware' : 'applyMiddleware'; // add a middleware handling the current user to the network interface\n\n      networkInterface.use([(_ref = {}, _ref[applyMiddlewareFn] = function (request, next) {\n        // get the login token on a per-request basis\n        var meteorLoginToken = getMeteorLoginToken(config); // no token, meaning no user connected, just go to next possible middleware\n\n        if (!meteorLoginToken) {\n          next();\n        } // create the header object if needed.\n\n\n        if (!request.options.headers) {\n          request.options.headers = {};\n        } // add the login token to the request headers\n\n\n        request.options.headers['meteor-login-token'] = meteorLoginToken; // go to next middleware\n\n        next();\n      }, _ref)]);\n    } catch (error) {\n      // catch the potential error sent by if a login token is manually set client-side\n      console.error(error);\n    }\n  }\n\n  return networkInterface;\n};\n\n// default Apollo Client configuration object\nvar defaultClientConfig = {\n  // setup ssr mode if the client is configured server-side (ex: for SSR)\n  ssrMode: Meteor.isServer\n}; // create a new client config object based on the default Apollo Client config\n// defined above and the client config passed to this function\n\nvar meteorClientConfig = function () {\n  var customClientConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return (0, _objectSpread2.default)({\n    // default network interface preconfigured, the network interface key is set\n    // there to so that `createMeteorNetworkInterface` is executed only when\n    // `meteorClientConfig` is called.\n    networkInterface: createMeteorNetworkInterface()\n  }, defaultClientConfig, customClientConfig);\n};\n\nvar getMeteorLoginToken = function () {\n  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  // possible cookie login token created by meteorhacks:fast-render\n  // and passed to the Apollo Client during server-side rendering\n  var _config$loginToken = config.loginToken,\n      loginToken = _config$loginToken === void 0 ? null : _config$loginToken; // Meteor accounts-base login token stored in local storage,\n  // only exists client-side as of Meteor 1.4, will exist with Meteor 1.5\n\n  var localStorageLoginToken = Meteor.isClient && Accounts._storedLoginToken(); // return a meteor login token if existing\n  // ex: grabbed from local storage or passed during server-side rendering\n\n\n  return localStorageLoginToken || loginToken;\n};","map":{"version":3,"sources":["packages/apollo/src/main-client.js"],"names":["module","export","createMeteorNetworkInterface","meteorClientConfig","getMeteorLoginToken","createNetworkInterface","createBatchingNetworkInterface","watch","require","v","Meteor","Accounts","defaultNetworkInterfaceConfig","uri","absoluteUrl","opts","useMeteorAccounts","batchingInterface","batchInterval","customNetworkInterfaceConfig","config","useBatchingInterface","interfaceToUse","interfaceArgument","networkInterface","isClient","loginToken","Error","applyMiddlewareFn","use","request","next","meteorLoginToken","options","headers","error","console","defaultClientConfig","ssrMode","isServer","customClientConfig","localStorageLoginToken","_storedLoginToken"],"mappings":"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","sourcesContent":["import { createNetworkInterface, createBatchingNetworkInterface } from 'apollo-client';\n\nimport { Meteor } from 'meteor/meteor';\nimport { Accounts } from 'meteor/accounts-base';\n\n// default network interface configuration object\nconst defaultNetworkInterfaceConfig = {\n  // default graphql server endpoint: ROOT_URL/graphql\n  // ex: http://locahost:3000/graphql, or https://www.my-app.com/graphql\n  uri: Meteor.absoluteUrl('graphql'),\n  // additional fetch options like `credentials` or `headers`\n  opts: {},\n  // enable the Meteor User Accounts middleware to identify the user with\n  // every request thanks to their login token\n  useMeteorAccounts: true,\n  // use a BatchingNetworkInterface by default instead of a NetworkInterface\n  batchingInterface: true,\n  // default batch interval\n  batchInterval: 10,\n};\n\n// create a pre-configured network interface\nexport const createMeteorNetworkInterface = (customNetworkInterfaceConfig = {}) => {\n  // create a new config object based on the default network interface config\n  // defined above and the custom network interface config passed to this function\n  const config = {\n    ...defaultNetworkInterfaceConfig,\n    ...customNetworkInterfaceConfig,\n  };\n\n  // this will be true true if a BatchingNetworkInterface is meant to be used\n  // with a correct poll interval\n  const useBatchingInterface = config.batchingInterface && typeof config.batchInterval === 'number';\n\n  // allow the use of a batching network interface\n  const interfaceToUse = useBatchingInterface\n    ? createBatchingNetworkInterface\n    : createNetworkInterface;\n\n  // http://dev.apollodata.com/core/apollo-client-api.html#NetworkInterfaceOptions\n  const interfaceArgument = {\n    uri: config.uri,\n    opts: config.opts,\n  };\n\n  // http://dev.apollodata.com/core/network.html#BatchingExample\n  if (useBatchingInterface) {\n    interfaceArgument.batchInterval = config.batchInterval;\n  }\n\n  // configure the (batching?) network interface with the config defined above\n  const networkInterface = interfaceToUse(interfaceArgument);\n\n  // handle the creation of a Meteor User Accounts middleware\n  if (config.useMeteorAccounts) {\n    try {\n      // throw an error if someone tries to specify the login token\n      // manually from the client\n      if (Meteor.isClient && config.loginToken) {\n        throw Error(\n          '[Meteor Apollo Integration] The current user is not handled with your GraphQL operations: you are trying to pass a login token to an Apollo Client instance defined client-side. This is only allowed during server-side rendering, please check your implementation.'\n        );\n      }\n\n      // dynamic middleware function name depending on the interface used\n      const applyMiddlewareFn = useBatchingInterface ? 'applyBatchMiddleware' : 'applyMiddleware';\n\n      // add a middleware handling the current user to the network interface\n      networkInterface.use([\n        {\n          [applyMiddlewareFn](request, next) {\n            // get the login token on a per-request basis\n            const meteorLoginToken = getMeteorLoginToken(config);\n\n            // no token, meaning no user connected, just go to next possible middleware\n            if (!meteorLoginToken) {\n              next();\n            }\n\n            // create the header object if needed.\n            if (!request.options.headers) {\n              request.options.headers = {};\n            }\n\n            // add the login token to the request headers\n            request.options.headers['meteor-login-token'] = meteorLoginToken;\n\n            // go to next middleware\n            next();\n          },\n        },\n      ]);\n    } catch (error) {\n      // catch the potential error sent by if a login token is manually set client-side\n      console.error(error);\n    }\n  }\n\n  return networkInterface;\n};\n\n// default Apollo Client configuration object\nconst defaultClientConfig = {\n  // setup ssr mode if the client is configured server-side (ex: for SSR)\n  ssrMode: Meteor.isServer,\n};\n\n// create a new client config object based on the default Apollo Client config\n// defined above and the client config passed to this function\nexport const meteorClientConfig = (customClientConfig = {}) => ({\n  // default network interface preconfigured, the network interface key is set\n  // there to so that `createMeteorNetworkInterface` is executed only when\n  // `meteorClientConfig` is called.\n  networkInterface: createMeteorNetworkInterface(),\n  ...defaultClientConfig,\n  ...customClientConfig,\n});\n\n// grab the token from the storage or config to be used in the network interface creation\nexport const getMeteorLoginToken = (config = {}) => {\n  // possible cookie login token created by meteorhacks:fast-render\n  // and passed to the Apollo Client during server-side rendering\n  const { loginToken = null } = config;\n\n  // Meteor accounts-base login token stored in local storage,\n  // only exists client-side as of Meteor 1.4, will exist with Meteor 1.5\n  const localStorageLoginToken = Meteor.isClient && Accounts._storedLoginToken();\n\n  // return a meteor login token if existing\n  // ex: grabbed from local storage or passed during server-side rendering\n  return localStorageLoginToken || loginToken;\n};\n"]},"sourceType":"script","hash":"0f446e79a382fa5e3d203decba2f669561651889"}
